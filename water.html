<!DOCTYPE html>

<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>水面の波紋アニメーション</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }

```
    .water-container {
        position: relative;
        width: 100vw;
        height: 100vh;
        background: radial-gradient(circle at center, #1a4d6b 0%, #0f2940 70%, #081820 100%);
        cursor: crosshair;
        overflow: hidden;
    }

    .ripple {
        position: absolute;
        border-radius: 50%;
        border: 2px solid rgba(135, 206, 235, 0.8);
        pointer-events: none;
        transform: translate(-50%, -50%);
    }

    .stone {
        position: absolute;
        width: 20px;
        height: 20px;
        background: radial-gradient(circle at 30% 30%, #8B7355, #4A4A4A);
        border-radius: 50%;
        transform: translate(-50%, -50%);
        z-index: 10;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    .stone-trajectory {
        position: absolute;
        width: 20px;
        height: 20px;
        background: radial-gradient(circle at 30% 30%, #8B7355, #4A4A4A);
        border-radius: 50%;
        z-index: 10;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    .instructions {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        color: rgba(255, 255, 255, 0.8);
        text-align: center;
        font-size: 18px;
        z-index: 100;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    }

    .water-surface {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
            radial-gradient(ellipse at 20% 30%, rgba(135, 206, 235, 0.1) 0%, transparent 50%),
            radial-gradient(ellipse at 80% 70%, rgba(135, 206, 235, 0.05) 0%, transparent 40%),
            radial-gradient(ellipse at 60% 20%, rgba(255, 255, 255, 0.03) 0%, transparent 30%);
        animation: waterShimmer 4s ease-in-out infinite alternate;
    }

    @keyframes waterShimmer {
        0% { opacity: 0.7; }
        100% { opacity: 1; }
    }

    @keyframes rippleExpand {
        0% {
            width: 0px;
            height: 0px;
            opacity: 1;
            border-width: 3px;
            border-color: rgba(135, 206, 235, 0.9);
        }
        25% {
            border-color: rgba(135, 206, 235, 0.7);
            border-width: 2px;
        }
        50% {
            border-color: rgba(135, 206, 235, 0.4);
            border-width: 1px;
        }
        100% {
            width: 400px;
            height: 400px;
            opacity: 0;
            border-width: 1px;
            border-color: rgba(135, 206, 235, 0);
        }
    }

    @keyframes stoneDrop {
        0% {
            transform: translate(-50%, -50%) scale(0.8);
            opacity: 0.7;
        }
        100% {
            transform: translate(-50%, -50%) scale(0.6);
            opacity: 0.3;
        }
    }

    @keyframes stoneThrow {
        0% {
            transform: scale(2.5) translate(-20%, -80%);
            opacity: 0.9;
            filter: blur(0px);
        }
        30% {
            transform: scale(1.8) translate(-15%, -40%);
            opacity: 1;
            filter: blur(0.5px);
        }
        70% {
            transform: scale(1.2) translate(-10%, -20%);
            opacity: 0.9;
            filter: blur(1px);
        }
        90% {
            transform: scale(0.8) translate(-5%, -5%);
            opacity: 0.7;
            filter: blur(1.5px);
        }
        100% {
            transform: scale(0.4) translate(0%, 0%);
            opacity: 0;
            filter: blur(2px);
        }
    }

    .ripple-1 { animation: rippleExpand 2s ease-out forwards; }
    .ripple-2 { 
        animation: rippleExpand 2.5s ease-out forwards; 
        animation-delay: 0.2s;
        border-color: rgba(135, 206, 235, 0.6);
    }
    .ripple-3 { 
        animation: rippleExpand 3s ease-out forwards; 
        animation-delay: 0.4s;
        border-color: rgba(135, 206, 235, 0.4);
    }
    .ripple-4 { 
        animation: rippleExpand 3.5s ease-out forwards; 
        animation-delay: 0.6s;
        border-color: rgba(135, 206, 235, 0.2);
    }
</style>
```

</head>
<body>
    <div class="water-container" id="waterContainer">
        <div class="water-surface"></div>
        <div class="instructions">
            水面をクリックして石を投げてください
        </div>
    </div>

```
<script>
    const waterContainer = document.getElementById('waterContainer');
    let rippleCount = 0;
    let audioContext = null;

    // Web Audio APIの初期化
    function initAudio() {
        if (!audioContext) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }
    }

    // 水しぶきの音を生成
    function playWaterSplash() {
        if (!audioContext) return;

        // メインの水しぶき音（ノイズベース）
        const duration = 0.8;
        const sampleRate = audioContext.sampleRate;
        const frameCount = sampleRate * duration;
        const buffer = audioContext.createBuffer(1, frameCount, sampleRate);
        const data = buffer.getChannelData(0);

        // ホワイトノイズを生成してフィルタリング
        for (let i = 0; i < frameCount; i++) {
            const t = i / sampleRate;
            const noise = (Math.random() * 2 - 1);
            const envelope = Math.exp(-t * 4) * (1 - Math.exp(-t * 20));
            const filtered = noise * envelope * 0.3;
            data[i] = filtered;
        }

        const source = audioContext.createBufferSource();
        source.buffer = buffer;

        // ローパスフィルターで水っぽい音に
        const filter = audioContext.createBiquadFilter();
        filter.type = 'lowpass';
        filter.frequency.setValueAtTime(800, audioContext.currentTime);
        filter.frequency.exponentialRampToValueAtTime(200, audioContext.currentTime + 0.5);

        // リバーブ効果
        const convolver = audioContext.createConvolver();
        const impulseBuffer = audioContext.createBuffer(2, sampleRate * 2, sampleRate);
        for (let channel = 0; channel < 2; channel++) {
            const impulseData = impulseBuffer.getChannelData(channel);
            for (let i = 0; i < impulseData.length; i++) {
                const n = impulseData.length - i;
                impulseData[i] = (Math.random() * 2 - 1) * Math.pow(n / impulseData.length, 2) * 0.1;
            }
        }
        convolver.buffer = impulseBuffer;

        // 接続
        source.connect(filter);
        filter.connect(convolver);
        convolver.connect(audioContext.destination);

        source.start(audioContext.currentTime);
        source.stop(audioContext.currentTime + duration);
    }

    // 小さな泡の音を生成
    function playBubbleSound(delay = 0) {
        if (!audioContext) return;

        setTimeout(() => {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(400 + Math.random() * 200, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 0.2);

            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.01);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.2);

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.2);
        }, delay);
    }

    function createRipple(x, y) {
        // オーディオ初期化
        initAudio();

        // 石の軌道アニメーション
        const stone = document.createElement('div');
        stone.className = 'stone-trajectory';
        stone.style.left = x + 'px';
        stone.style.top = y + 'px';
        stone.style.animation = 'stoneThrow 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards';
        waterContainer.appendChild(stone);

        // 着水音を再生（石が水面に到達するタイミング）
        setTimeout(() => {
            playWaterSplash();
            // 小さな泡音を複数回再生
            playBubbleSound(100);
            playBubbleSound(300);
            playBubbleSound(500);
        }, 1000);

        // 複数の波紋を作成（石が着水するタイミングで開始）
        setTimeout(() => {
            for (let i = 1; i <= 4; i++) {
                setTimeout(() => {
                    const ripple = document.createElement('div');
                    ripple.className = `ripple ripple-${i}`;
                    ripple.style.left = x + 'px';
                    ripple.style.top = y + 'px';
                    ripple.id = `ripple-${rippleCount}-${i}`;
                    
                    waterContainer.appendChild(ripple);

                    // アニメーション終了後に要素を削除
                    setTimeout(() => {
                        if (ripple && ripple.parentNode) {
                            ripple.parentNode.removeChild(ripple);
                        }
                    }, 3500 + (i * 500));
                }, i * 100);
            }
        }, 1000); // 石の軌道アニメーションの途中で波紋開始

        // 石を削除
        setTimeout(() => {
            if (stone && stone.parentNode) {
                stone.parentNode.removeChild(stone);
            }
        }, 1200);

        rippleCount++;
    }

    waterContainer.addEventListener('click', function(e) {
        const rect = waterContainer.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        createRipple(x, y);
    });

    // 初期デモンストレーション
    setTimeout(() => {
        const centerX = waterContainer.offsetWidth / 2;
        const centerY = waterContainer.offsetHeight / 2;
        createRipple(centerX, centerY);
    }, 1000);

    // ユーザージェスチャーでオーディオを有効化（ブラウザのポリシー対応）
    document.addEventListener('click', function enableAudio() {
        initAudio();
        if (audioContext && audioContext.state === 'suspended') {
            audioContext.resume();
        }
        document.removeEventListener('click', enableAudio);
    }, { once: true });
</script>
```

</body>
</html>